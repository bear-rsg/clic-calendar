{% extends "base.html" %}
{% load static %}

{% block main %}
    
    <div class="container">
    
        {% include 'calendar/snippets/back-link.html' %}

        <h2>{{ object.month }} {{ object.year }}</h2>

        <div id="question-detail">

            <div id="question-detail-title">
                {{ object.question_text }}
            </div>

            <!-- Optional question image -->
            {% if object.question_image %}
                <img id="question-detail-image" src="{{ object.question_image.url }}" alt="CLiC Calendar image supporting the question" title="CLiC Calendar image supporting the question">
            {% endif %}

        </div>

        <!-- Form to create and submit an answer to the above question -->
        <form enctype="multipart/form-data" id="answer-create-form" name="answer-create-form" method="POST" action="{% url 'answer-create' %}">

            <!-- Security CSRF token -->
            {% csrf_token %}

            <!-- Form -->
            {{ form.as_p }}

            <!-- Submit form button -->
            <button id="answer-create-submit" class="btn btn-primary" type="submit">Submit Answer</button>

            <!-- Answer char counter -->
            <div id="answer-create-counter">
                <span id="answer-create-counter-count"></span> / 1000
            </div>

        </form>
        <!-- Form script  -->
        <script>
            $(document).ready(function() {
                // Sets the value of the question in the answer form to the current question id
                $('#id_question').val({{ object.id }}).hide();
                // Update story create character count
                $('#id_answer_text').on('input', function() {
                    $('#answer-create-counter-count').text($(this).val().length)
                }).trigger('input');
            });
        </script>

        
        

        <div id="answer-list">
            <h2>Answers</h2>

            {% for answer in answers %}

                <!-- Answer -->
                <div class="answer-list-item">
                    <div class="answer-list-item-created">
                        {{ answer.meta_created_datetime }}
                    </div>
                    <div class="answer-list-item-text">
                        {{ answer.answer_text | safe | linebreaksbr }}
                    </div>
                </div>

                <!-- Link to submit your own answer, after every 10 answers-->
                {% if forloop.counter|divisibleby:"10" %}
                    <div class="answer-list-link">
                        <span class="answer-list-link-text">Remember, you can submit your own answer to this month's question!</span>
                        {% include 'calendar/snippets/answer-link.html' %}
                    </div>
                {% endif %}
            
            <!-- If no content... -->
            {% empty %}
                <div id="answer-list-empty">
                    There aren't any answers from other users to show here yet.
                    <br>
                    Be the first by <a href="{% url 'answer-create' %}">submitting your answer!</a>
                </div>
            {% endfor %}
        </div>

    </div>

{% endblock %}